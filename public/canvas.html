<html>
	<head>
		<title>ws-paint canvas</title>
	</head>
	<body>
		<div>
			<canvas id="paint-canvas" width="200" height="200" style="border:1px solid #000000;">
			</canvas>
		</div>

		<script src="/socket.io/socket.io.js"></script>
		<script>
			(function(global, undefined) {
				var WsPaint = {};

				WsPaint.Controller = function(options) {
					var socket 	= options.socket,
						canvas  = options.canvas,
						context = canvas.getContext('2d'),
						view 	= new WsPaint.Canvas(context),
						drawing = false;

					// Setup socket event handlers
					socket.on('connect', 	socketConnected);
				    socket.on('disconnect', socketDisconnected);
				    socket.on('data', 		socketReceivedData);

				    // Setup canvas event handlers
					canvas.addEventListener("mousedown", mouseDown, false);
					canvas.addEventListener("mouseup", 	 mouseUp, 	false);
					canvas.addEventListener("mousemove", mouseMove, false);

					function socketConnected() {
				        console.log('Client has connected to the server!');
					}

					function socketDisconnected() {
				        console.log('Client has disconnected!');
					}

					function socketReceivedData(data) {
				        console.log('Received a message from the server!', data);

				        drawPoint(data.point);
					}

					function mouseDown(event) {
						drawing = true;
						handleMouseEvent(event);
					}

					function mouseUp(event) {
						drawing = false;
					}

					function mouseMove(event) {
						if (drawing) {
							handleMouseEvent(event);
						}
					}

					function handleMouseEvent(event) {
						var point = {
							x: event.x, 
							y: event.y 
						};

						addPoint(point);
					}

					function sendPoint(point) {
						console.log(point);

						socket.emit('data', {
							point: point
						})
					}

					function pointSize() {
						return 0.02 * (canvas.width + canvas.height) / 2;
					}

					function drawPoint(point) {
						view.drawPoint(point, pointSize());
					}

					function addPoint(point) {
						sendPoint(point);
						drawPoint(point);
					}
				}

				WsPaint.Canvas = function(context) {
					return {
						drawPoint: function(point, size) {
							context.beginPath();
							context.arc(point.x, point.y, size, 0, 2 * Math.PI, true);
							context.fill();
						}
					};
				}

				new WsPaint.Controller({
					socket: io.connect('localhost'),
					canvas: document.getElementById("paint-canvas")
				});
				
			})(this);
		</script>
	</body>
</html>
